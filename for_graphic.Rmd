---
title: "Undergraduate Enrollment and Class Offerings, by Dept"
author: "Simone Chu"
date: "4/9/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(readxl)
library(fs)
library(gganimate)
library(ggthemes)
library(janitor)
library(tidyverse)
```

```{r downloading_data, echo=FALSE, include=FALSE, warning=FALSE, message=FALSE, cache=TRUE}

# Getting the necessary data (I chose to narrow it down to the past 4 years, so I'm loading 
# eight different datasets)!

# Because some of these datasets were formatted differently (for example, in some, the column 
# that contained info about undergraduate enrollment (u_grad) was called "hcol"), I did some 
# cleaning up. I also made sure that all the column names were in snake case, for easy use later
# on. 

download.file("https://registrar.fas.harvard.edu/files/fas-registrar/files/class_enrollment_summary_by_term_3.22.19.xlsx", destfile = "s19.xlsx")
s19 <- read_excel("s19.xlsx", skip = 3) %>%
  clean_names() %>%
  filter(u_grad > 0) %>%
  group_by(course_department) %>%
  summarize(n_courses = n(), enrollment = sum(u_grad))
  file_delete("s19.xlsx")
  
download.file("https://registrar.fas.harvard.edu/files/fas-registrar/files/class_enrollment_summary_by_term_10.24.18.xlsx", destfile = "f18.xlsx")
f18 <- read_excel("f18.xlsx", skip = 2) %>%
  clean_names() %>%
  filter(u_grad > 0) %>%
  group_by(course_department) %>%
  summarize(n_courses = n(), enrollment = sum(u_grad))
  file_delete("f18.xlsx")

download.file("https://registrar.fas.harvard.edu/files/fas-registrar/files/class_enrollment_summary_by_term_03.06.18.xlsx", destfile = "s18.xlsx")
s18 <- read_excel("s18.xlsx", skip = 3) %>%
  clean_names() %>%
  filter(u_grad > 0) %>%
  group_by(course_department) %>%
  summarize(n_courses = n(), enrollment = sum(u_grad))
  file_delete("s18.xlsx")
  
download.file("https://registrar.fas.harvard.edu/files/fas-registrar/files/class_enrollment_summary_by_term_10.20.17.xlsx", destfile = "f17.xlsx")
f17 <- read_excel("f17.xlsx", skip = 3) %>%
  clean_names() %>%
  filter(u_grad > 0) %>%
  group_by(course_department) %>%
  summarize(n_courses = n(), enrollment = sum(u_grad))
  file_delete("f17.xlsx")

download.file("http://registrar.fas.harvard.edu/files/fas-registrar/files/class_enrollment_summary_by_term_2017_03_07_final_0.xlsx", destfile = "s17.xlsx")
s17 <- read_excel("s17.xlsx", skip = 3) %>%
  clean_names() %>%
  filter(u_grad > 0) %>%
  group_by(course_department) %>%
  summarize(n_courses = n(), enrollment = sum(u_grad))
  file_delete("s17.xlsx")
  
download.file("http://registrar.fas.harvard.edu/files/fas-registrar/files/copy_of_class_enrollment_summary_by_term_10.06.2016.xlsx", destfile = "f16.xlsx")
f16 <- read_excel("f16.xlsx", skip = 3) %>%
  clean_names() %>%
  filter(u_grad > 0) %>%
  group_by(course_department) %>%
  summarize(n_courses = n(), enrollment = sum(u_grad))
  file_delete("f16.xlsx")
  
# I put each semester's data in a separate set of lines of code so that R could delete the files
# as it ran -- hopefully that makes it faster? If not, I guess this was unnecessary, but I liked
# having things organized this way. 
  
```

```{r, echo=FALSE, include=FALSE, warning=FALSE, message=FALSE}

all <- bind_rows(f16, s17, f17, s18, f18, s19, .id = "term") %>%
  filter(!is.na(course_department)) %>%
  filter(course_department != "No Department") %>%
  mutate(division = case_when(
    course_department %in% c("Celtic Languages & Literatures", "Classics, The", 
                             "Comparative Literature", "East Asian Langs & Civ",
                             "English", "Germanic Languages & Lit",
                             "History of Art & Architecture", "Linguistics",
                             "Music", "Near Eastern Languages & Civ", 
                             "Philosophy", "Romance Languages & Lit",
                             "Slavic Languages & Literatures", "South Asian Studies",
                             "Theater, Dance & Media", "Folklore & Mythology",
                             "History & Literature", "Religion, The Study of",
                             "Visual & Environmental Studies", "American Studies",
                             "Humanities", "Medieval Studies", 
                             "Regional Studies-East Asia", "Ukrainian Studies",
                             "Russia, E Europe, Central Asia") ~ "hum",
    
    course_department %in% c("Astronomy", "Chemistry & Chemical Biology",
                             "Chemical & Physical Biology", "Earth & Planetary Sciences",
                             "Human Evolutionary Biology", "Mathematics", 
                             "Molecular & Cellular Biology", "Organismic & Evolutionary Biol",
                             "Physics", "Statistics", "Stem Cell & Regenerative Biol",
                             "Systems Biology", "Mind, Brain & Behavior",
                             "Medical Sciences", "Neurobiology",
                             "Bio Sciences in Public Health", "Biophysics",
                             "Biostatistics", "Neuroscience") ~ "sci",
    
    course_department %in% c("African & African Amer Studies", "Anthropology", 
                             "Economics", "Government", "History", 
                             "History of Science", "Psychology", 
                             "Social Studies", "Sociology",
                             "Women, Gender & Sexuality",
                             "Ethnicity, Migration, Rights",
                             "Envi Science & Public Policy", 
                             "Global Health & Health Policy", "Health Policy") ~ "soc",
    
    course_department %in% c("Applied Computation", "Applied Mathematics",
                             "Applied Physics", "Biomedical Engineering",
                             "Computer Science", "Engineering Sciences",
                             "Environmental Sci & Engineer") ~ "seas",
    
    course_department == "Special Concentrations" ~ "spec",
    
    course_department == "Expository Writing" ~ "expos",
    
    course_department == "Freshman Seminars" ~ "fresh",
    
    course_department == "General Education" ~ "gen_ed", 
    
    course_department == "House Seminars" ~ "house"
  ))
  
# I wanted a cool way to see trends by division (i.e., Arts & Humanities, Social Sciences,
# Sciences, and SEAS), so I assigned divisions to each of the course departments. This will 
# help me make a cool graphic with nice colors later on! 

# I based the divisions on this page: https://www.fas.harvard.edu/pages/academic-divisions. 
# Sadly, not every department that appears in these datasets was accounted for by FAS, so I used # common sense to sort the rest (for example, it seemed reasonable to place "Neurobiology" under 
# the Sciences division, and "Humanities" under the Humanities division). 

```


```{r, echo=FALSE, include=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

ggplot(all, aes(x = n_courses, y = enrollment, size = enrollment, alpha = course_department, color = division)) +
  geom_point() +
  theme_economist_white() +
  # theme(legend.position = "none") +
  transition_states(term) + 
  labs(title = "Changes in Department Size, Fall 2016 - Spring 2019") + 
  xlab("Number of Courses Offered") + 
  ylab("Undergraduate Enrollment")
  
```

